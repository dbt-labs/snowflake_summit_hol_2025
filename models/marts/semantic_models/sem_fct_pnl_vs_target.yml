semantic_models:
- name: pnl_vs_target
  description: Portfolio PnL vs Target allocation analysis by desk and region.
  model: ref('fct_pnl_vs_target')
  defaults:
    agg_time_dimension: trade_date
  entities:
  - name: desk
    type: foreign
  - name: region
    type: foreign
  dimensions:
  - name: trade_date
    type: time
    type_params:
      time_granularity: day
  - name: allocation_status
    type: categorical
  measures:
  - name: portfolio_value_usd
    description: Total portfolio value in USD by desk and region.
    agg: sum
    create_metric: true
  - name: total_portfolio_value_usd
    description: Total portfolio value in USD across all desks and regions.
    agg: sum
    create_metric: true
  - name: portfolio_vs_open_performance
    description: Average portfolio performance vs open price.
    agg: average
    create_metric: true
  - name: portfolio_vs_close_performance
    description: Average portfolio performance vs close price.
    agg: average
    create_metric: true
  - name: portfolio_market_performance
    description: Average portfolio market performance.
    agg: average
    create_metric: true
  - name: portfolio_relative_performance
    description: Average portfolio relative performance.
    agg: average
    create_metric: true
  - name: total_best_price_trades
    description: Total number of best price trades.
    agg: sum
    create_metric: true
  - name: total_worst_price_trades
    description: Total number of worst price trades.
    agg: sum
    create_metric: true
  - name: total_middle_price_trades
    description: Total number of middle price trades.
    agg: sum
    create_metric: true
  - name: actual_allocation
    description: Actual allocation of portfolio value compared to total portfolio
      value.
    agg: average
    create_metric: true
  - name: allocation_variance
    description: Variance between actual allocation and target allocation.
    agg: average
    create_metric: true
  - name: count_desk
    agg: count_distinct
    create_metric: true
  - name: count_region
    agg: count_distinct
    create_metric: true
  primary_entity: pnl_vs_target
